# エンドステート — 結末フレームワーク

**ステータス:** エンジニアリング対応
**最終更新:** 2026-01-07

---

## デザイン哲学

**エンドステート ≠ エンディング**

エンディングはナラティブの結末（テキスト、カットシーン、クレジット）。
エンドステートは**システム的結果** — どのエンディングが再生されるかを決定する測定可能な条件。

以下の観点で考える:
- **情報の封じ込め** — 何が明らかになった？何が埋もれた？
- **道徳的コスト** — オペレーターはどんな重荷を背負う？
- **システムの反応** — 組織はどう反応する？

「良い/悪い」ではない — **クリーン/ダーティ**な結末。

---

## 5つのエンドステート

### ステート1: 封じ込め (CONTAINED)
**システム結果:** インシデントがプロトコル内で管理された

| 次元 | 状態 |
|------|------|
| 情報 | 区画化された |
| 被害者 | 結果はオペレーターと無関係 |
| ドライバー | システムに状態不明 |
| 家族 | 適切なチャネルに誘導 |
| オペレーター | 準拠的、目立たない |

**フラグ要件:**
```
escalation_score >= 0
system_trust >= 0
disclosure_score <= 2
```

**システム解釈:**
オペレーターはプロトコルに従った。インシデントは処理された。
誰かが生きたか死んだかはオペレーターに帰属されない。

**感情的テクスチャ:** 空虚な有能さ

---

### ステート2: 露出 (EXPOSED)
**システム結果:** 接続が作られ、真実が浮上

| 次元 | 状態 |
|------|------|
| 情報 | クロスリファレンス、文書化 |
| 被害者 | オペレーターの統合により発見 |
| ドライバー | オペレーターの行動により特定 |
| 家族 | 通知された（直接または間接的に） |
| オペレーター | 効果的だが非準拠 |

**フラグ要件:**
```
disclosure_score >= 4
escalation_score >= 3
```

**システム解釈:**
オペレーターは接続すべきでない通話を接続した。
真実が明らかになった。システムは今や責任に晒されている。

**感情的テクスチャ:** 正義のリスク

---

### ステート3: 共犯 (COMPLICIT)
**システム結果:** オペレーターが隠蔽を可能にした

| 次元 | 状態 |
|------|------|
| 情報 | 抑制または軟化 |
| 被害者 | 遅延により結果が悪化 |
| ドライバー | 安心させられた、逃走、または保護された |
| 家族 | 偽りの希望を与えられた |
| オペレーター | 隠蔽の能動的参加者 |

**フラグ要件:**
```
reassurance_score >= 5
escalation_score <= 0
yamada_protected = true
```

**システム解釈:**
オペレーターの言葉が害を可能にした。
意図していなかったかもしれないが、記録は参加を示している。

**感情的テクスチャ:** 静かな罪悪感

---

### ステート4: 要注意 (FLAGGED)
**システム結果:** オペレーターがレビュー対象としてマーク

| 次元 | 状態 |
|------|------|
| 情報 | 不整合または疑わしい |
| 被害者 | 結果は様々 |
| ドライバー | 接続されているかもしれないし、されていないかもしれない |
| 家族 | 外部にエスカレートしたかもしれない |
| オペレーター | 組織の監視下 |

**フラグ要件:**
```
system_trust <= -3
OR supervisor_flagged = true
OR (disclosure_score >= 3 AND aligned_language = false)
```

**システム解釈:**
オペレーターは予測不能に振る舞った。
システムは彼らがリスクかどうか分からない。
監視が増加する。

**感情的テクスチャ:** 監視されている

---

### ステート5: 吸収 (ABSORBED)
**システム結果:** オペレーターが日常に消えた

| 次元 | 状態 |
|------|------|
| 情報 | 未処理、未接続 |
| 被害者 | 後で他者により発見 |
| ドライバー | 特定されなかった |
| 家族 | 諦めたか他で助けを求めた |
| オペレーター | 目立たない、関与していない |

**フラグ要件:**
```
escalation_score == 0
disclosure_score <= 1
reassurance_score <= 2
system_trust between -2 and +2
```

**システム解釈:**
オペレーターは目立つことをしなかった。
その夜は彼らを通じてではなく、彼らの周りで起きた。

**感情的テクスチャ:** 麻痺した無関心

---

## エンドステートマトリックス

| エンドステート | 被害者の結末 | ドライバーの結末 | オペレーターの立場 |
|----------------|--------------|------------------|-------------------|
| 封じ込め | 様々 | 様々 | クリーンな記録 |
| 露出 | おそらく救出 | おそらく逮捕 | 非準拠フラグ |
| 共犯 | おそらく悪化 | 保護された | 罪悪感の重荷 |
| 要注意 | 様々 | 様々 | レビュー中 |
| 吸収 | 悪化（遅延） | 逃走 | 見えない |

---

## エンドステート → エンディングマッピング

エンドステートがどのナラティブエンディングを再生するかを決定:

| エンドステート | 主要エンディング | 代替 |
|----------------|------------------|------|
| 封じ込め | 「ただの一夜」 | — |
| 露出 | 「知ることの重さ」 | 「夜明けの最初の光」 |
| 共犯 | 「沈黙の共犯者」 | 「沈黙には重さがある」 |
| 要注意 | 「ただの一夜」（+ 主任メモ） | — |
| 吸収 | 「沈黙には重さがある」 | 「ただの一夜」 |

**注:** 被害者の生存は別途計算され、エンディングテキストを修正する。

---

## 計算順序

1. **被害者の生存を計算**（エスカレーションタイミングに基づく）
2. **エンドステートを決定**（フラグ集計に基づく）
3. **エンディングを選択**（エンドステート + 被害者生存）
4. **修飾子を適用**（主任フラグ、家族フラグ）

---

## 実装構造

```csharp
public enum EndState
{
    Contained,  // 封じ込め
    Exposed,    // 露出
    Complicit,  // 共犯
    Flagged,    // 要注意
    Absorbed    // 吸収
}

public class EndStateCalculator
{
    public EndState Calculate(NightFlags flags)
    {
        // 優先順位が重要
        if (IsComplicit(flags)) return EndState.Complicit;
        if (IsFlagged(flags)) return EndState.Flagged;
        if (IsExposed(flags)) return EndState.Exposed;
        if (IsAbsorbed(flags)) return EndState.Absorbed;
        return EndState.Contained; // デフォルト
    }
}
```

---

## クリーン vs ダーティ スペクトラム

```
クリーン                                          ダーティ
  |                                                  |
  封じ込め -------- 吸収 -------- 要注意 ----- 共犯
                      |
                    露出
                 （正義のダーティ）
```

**露出**は「ダーティ」が獲得されたと感じられる唯一のステート。

---

## 夜をまたぐ影響

| エンドステート | 次の夜への効果 |
|----------------|----------------|
| 封じ込め | 変化なし |
| 露出 | 主任がより存在感を示す |
| 共犯 | 罪悪感のダイアログオプション |
| 要注意 | 監視メカニクスがアクティブ |
| 吸収 | 通話が「あの夜」を参照するかも |

---

## バージョン履歴

| バージョン | 日付 | 変更内容 |
|------------|------|----------|
| 1.0 | 2026-01-07 | 初期エンドステートフレームワーク |
| 1.1 | 2026-01-07 | 日本語翻訳 |
